@page
@model NaturalDisasterInformationSystem.Pages.User.HomeModel
@{

}
@{
    ViewData["Title"] = "Home page";
    var roleId = HttpContext.Session.GetString("RoleId") ?? Request.Cookies["RoleId"];
    var userId = HttpContext.Session.GetString("UserId") ?? Request.Cookies["UserId"];
    var sdt = HttpContext.Session.GetString("SDT") ?? Request.Cookies["SDT"];
}
 <style>
    /* Set the height for the map */
    #windy {
        width: 80%; /* Gi·∫£m chi·ªÅu r·ªông ƒë·ªÉ ch·ª´a ch·ªó cho b·∫£ng c·∫£nh b√°o */
        height: 700px;
        float: right;
    }

    /* B·∫£ng c·∫£nh b√°o n·∫±m b√™n tr√°i */
    #warningPanel {
        width: 20%;
        height: 700px;
        overflow-y: hidden;
        overflow-x: hidden;
        position: relative;
        float: left;
        background-color: #f9f9f9;
        padding: 10px;
        box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.2);
    }

    /* T·∫°o container cho vƒÉn b·∫£n c·∫£nh b√°o cu·ªôn l√™n */
    .scrolling-container {
        position: absolute;
        bottom: 0;
        animation: scrollUp 30s linear infinite;
    }

    /* M√†u s·∫Øc t∆∞∆°ng ·ª©ng v·ªõi m·ª©c ƒë·ªô thi√™n tai */
    .low-level {
        background-color: #d4edda;
    }
    /* M√†u xanh nh·∫°t cho m·ª©c ƒë·ªô th·∫•p */
    .moderate-level {
        background-color: #fff3cd;
    }
    /* M√†u v√†ng nh·∫°t cho m·ª©c ƒë·ªô trung b√¨nh */
    .high-level {
        background-color: #f8d7da;
    }
    /* M√†u ƒë·ªè nh·∫°t cho m·ª©c ƒë·ªô cao */

    .warning-box {
        border: 1px solid #ccc;
        margin: 10px 0;
        padding: 10px;
        border-radius: 4px;
    }

    /* Keyframes ƒë·ªÉ cu·ªôn vƒÉn b·∫£n t·ª´ d∆∞·ªõi l√™n */
    @@keyframes scrollUp {
        0% {
            transform: translateY(100%);
        }

        100% {
            transform: translateY(-100%);
        }

        /* Style for the table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }
        /*-----------------------*/
        #filterSection {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin: 20px 0;
        gap: 10px;
    }

    select {
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #f9f9f9;
        font-size: 16px;
        width: 200px;
        transition: all 0.3s ease;
    }

    select:hover {
        border-color: #007bff;
        box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
    }

    input[type="text"] {
        padding: 8px 12px;
        width: 250px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    input[type="text"]:focus {
        border-color: #28a745;
        box-shadow: 0 0 8px rgba(40, 167, 69, 0.3);
        outline: none;
    }

    label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
    }

    input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }
    #logo-wrapper{display:none;}

    @@media (max-width: 768px) {
        #filterSection {
            flex-direction: column;
            gap: 15px;
        }

        select, input[type="text"] {
            width: 100%;
        }
    }
   @@media only screen and (min-width: 992px) {
    #ftco-navbar1 {
        margin-top: 50px; 
    }
}

    </style>
<style>
    #logo-wrapper {
        display: none;
    }
    @@keyframes scroll {
        0% {
            transform: translateX(10%);
        }

        100% {
            transform: translateX(-50%);
        }
    }

    .scroll-container {
      
    }
</style>
  
<nav class=" navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar1" style="margin-top:50px;z-index:2">
    <div>
        <h2>
            @if (Model.Disasters != null && Model.Disasters.Count > 0)
            {
                var dateNow = DateTime.Now; // Get the current date and time
                <div style="overflow: hidden; white-space: nowrap; width: 100%;">
                    <div style="display: inline-block; opacity: 1; animation: scroll 50s linear infinite;color:#FFD700">
                        @foreach (var disaster in Model.Disasters)
                        {
                            // Check if TimeUpdate is within the last 5 days
                            if (disaster.TimeUpdate >= dateNow.AddDays(-7))
                            {
                                <div style=" display: inline-block; min-width: 200px;">
                                    C·∫£nh b√°o c√≥ @if (disaster.DisasterDetails != null)
                                    {
                                        <strong>@disaster.DisasterDetails.NameDisaster</strong>
                                    } ·ªü @disaster.AffectedArea .ƒê√¢y l√† thi√™n tai c·∫•p @disaster.Level .
@*                                      <strong>Th·ªùi gian b·∫Øt ƒë·∫ßu:</strong> @disaster.TimeStart.ToString("g")
 *@                                    <strong>Th·ªùi gian c·∫≠p nh·∫≠t:</strong> @disaster.TimeUpdate.ToString("g")

                                </div>
                            }
                        }
                    </div>
                </div>
            }
            else
            {
                <p>No disaster information available.</p>
            }
        </h2>

    </div>
</nav>
<div class=""

     style="background-image: url('/assets/images/bg_7.jpg');
           background-size: cover; background-position: center center;
           background-attachment: fixed; min-height: 100vh; display: flex;
           align-items: center; justify-content: center; position: relative;">

    <div class="overlay"
         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
               background: rgba(0, 0, 0, 0.5); z-index: 1;"></div>

    <div class="container"
         style="position: relative; z-index: 1; padding: 20px; max-width: 1400px;
               margin: 0 auto; width: 100%; padding-top: 73px;">
        @* <div class="container">
            <h2>Submit Your Report</h2>
            <form id="reportForm" method="post">
                <div class="form-group">
                    <label for="content">Content:</label>
                    <input type="text" id="content" name="content" required class="form-control" />
                </div>
                <input type="hidden" id="longitude" name="longitude" />
                <input type="hidden" id="latitude" name="latitude" />
                <input type="hidden" name="userId" value="@userId" />
                <div class="form-group">
                    <button type="button" id="getLocation" class="btn btn-primary">Get My Location</button>
                    <button type="submit" class="btn btn-success">Submit</button>
                </div>
            </form>
        </div> *@
         @if(userId!=null){
        <button id="sosButton" class="btn btn-danger" style="margin-top:50px">SOS</button>
        <div id="reportModal" class="modal" style="display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.4);">
            <div class="modal-content" style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%;">
                <span class="close" onclick="document.getElementById('reportModal').style.display='none'" style="color: #aaa; float: right; font-size: 28px; font-weight: bold;">&times;</span>
                <div class="container">
                    <h2>G·ª≠i Y√™u C·∫ßu H·ªó Tr·ª£</h2>
                        <form id="reportForm" asp-page-handler="AddReport" method="post" enctype="multipart/form-data">
                            <div class="form-container" style="display: flex; flex-wrap: wrap; justify-content: space-between; gap: 20px; margin: 20px 0;">
                                <!-- B√™n tr√°i: N·ªôi dung v√† t·∫£i ·∫£nh -->
                                <div class="form-left" style="flex: 1; min-width: 45%; margin-bottom: 20px;">
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label for="content">N·ªôi dung:</label>
                                        <textarea id="content" name="content" required class="form-control" rows="4" style="width: 100%; max-width: 500px; padding: 8px; border-radius: 5px; box-sizing: border-box;">T√¥i ƒëang g·∫∑p nguy hi·ªÉm v√† c·∫ßn tr·ª£ gi√∫p. ƒê√¢y l√† s·ªë ƒëi·ªán tho·∫°i c·ªßa t√¥i @sdt...</textarea>
                                    </div>

                                    <!-- T·∫£i ·∫£nh -->
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label for="imgSos">T·∫£i ·∫£nh l√™n:</label>
                                        <input type="file" id="imgSos" name="imgSos" accept="image/*,video/*" class="form-control" multiple style="width: 100%; padding: 8px; border-radius: 5px; box-sizing: border-box;" />
                                    </div>
                                </div>

                                <!-- B√™n ph·∫£i: Ch·ªçn ƒë·ªãa ch·ªâ -->
                                <div class="form-right" style="flex: 1; min-width: 45%; margin-bottom: 20px;">
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label for="province">T·ªânh/Th√†nh ph·ªë:</label>
                                        <select id="province" name="province" class="form-control" onchange="updateAddress()" style="width: 100%; height: 40px; padding: 8px; border-radius: 5px; box-sizing: border-box;">
                                            <option value="">Ch·ªçn t·ªânh/th√†nh ph·ªë</option>
                                            <!-- C√°c t·ªânh s·∫Ω ƒë∆∞·ª£c l·∫•y t·ª´ API -->
                                        </select>

                                        <label for="district">Qu·∫≠n/Huy·ªán:</label>
                                        <select id="district" name="district" class="form-control" onchange="updateAddress()" style="width: 100%; height: 40px; padding: 8px; border-radius: 5px; box-sizing: border-box;">
                                            <option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>
                                            <!-- C√°c qu·∫≠n s·∫Ω ƒë∆∞·ª£c l·∫•y t·ª´ API d·ª±a tr√™n t·ªânh/th√†nh ph·ªë ƒë√£ ch·ªçn -->
                                        </select>

                                        <label for="commune">X√£/Ph∆∞·ªùng:</label>
                                        <select id="commune" name="commune" class="form-control" onchange="updateAddress()" style="width: 100%; height: 40px; padding: 8px; border-radius: 5px; box-sizing: border-box;">
                                            <option value="">Ch·ªçn x√£/ph∆∞·ªùng</option>
                                            <!-- C√°c x√£ s·∫Ω ƒë∆∞·ª£c l·∫•y t·ª´ API d·ª±a tr√™n qu·∫≠n/huy·ªán ƒë√£ ch·ªçn -->
                                        </select>

                                        <label for="village">Th√¥n/X√≥m (Nh·∫≠p n·∫øu kh√¥ng c√≥ trong danh s√°ch):</label>
                                        <input type="text" id="village" name="village" class="form-control" placeholder="Nh·∫≠p t√™n th√¥n/x√≥m (n·∫øu kh√¥ng c√≥ trong danh s√°ch)" oninput="updateAddress()" style="width: 100%; padding: 8px; border-radius: 5px; box-sizing: border-box;" />

                                        <!-- Tr∆∞·ªùng ƒë·ªãa ch·ªâ ·∫©n -->
                                        <input type="hidden" id="address" name="address" />
                                    </div>
                                </div>
                            </div>

                            <input type="hidden" id="longitude" name="longitude" />
                            <input type="hidden" id="latitude" name="latitude" />
                            <input type="hidden" name="userId" value="@userId" />

                            <div class="form-group" style="margin-top: 20px;">
                                <button type="button" id="getLocation" class="btn btn-primary" style="padding: 10px 20px; font-size: 16px; margin-right: 10px;">L·∫•y v·ªã tr√≠</button>
                                <button type="submit" class="btn btn-success" style="padding: 10px 20px; font-size: 16px;">G·ª≠i</button>
                            </div>
                        </form>



                </div>
            </div>
        </div>
         }
      
        <div>
            <div id="windy" style="width: 100%; height: 700px; float: right; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);"></div> <!-- V√πng ch·ª©a b·∫£n ƒë·ªì -->

@*             <div id="warningPanel" style="width: 25%; height: 700px; overflow-y: auto; float: left; background-color: #f5f5f5; padding: 15px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div class="scrolling-container" style="animation: scrollUp 20s linear infinite; position: relative;">
                    <!-- Ki·ªÉm tra v√† hi·ªÉn th·ªã c·∫£nh b√°o n·∫øu c√≥ d·ªØ li·ªáu thi√™n tai -->
                    @if (Model.Disasters != null && Model.Disasters.Count > 0)
                    {
                        var dateNow = DateTime.Now;
                        var hasRecentDisaster = false;

                        foreach (var disaster in Model.Disasters)
                        {
                            if (disaster.TimeUpdate >= dateNow.AddDays(-7))
                            {
                                hasRecentDisaster = true;

                                var levelClass = disaster.Level <= 3 ? "low-level" :
                                (disaster.Level > 3 && disaster.Level <= 7) ? "moderate-level" : "high-level";

                                <div class="warning-box @levelClass" data-id="@disaster.Id" style="margin-bottom: 15px; padding: 10px 15px; border-radius: 5px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); font-size: 0.9rem;
                background-color: @(disaster.Level <= 3 ? "#d4edda" : (disaster.Level <= 7 ? "#fff3cd" : "#f8d7da"));
                border-left: 5px solid @(disaster.Level <= 3 ? "#28a745" : (disaster.Level <= 7 ? "#ffc107" : "#dc3545"));">

                                    <strong>Lo·∫°i h√¨nh:</strong> @disaster.DisasterDetails?.NameDisaster <br>
                                    <strong>Khu v·ª±c:</strong> @disaster.AffectedArea <br>
                                    <strong>Th·ªùi gian:</strong> @disaster.TimeUpdate.ToString("g") <br>
                                    <strong>C·∫•p ƒë·ªô:</strong> @disaster.Level
                                </div>
                            }
                        }

                        if (!hasRecentDisaster)
                        {
                            <div style="display: flex; justify-content: center; align-items: center; height: 200px;">
                                <p style="color: #666; font-size: 0.9rem; text-align: center;">Kh√¥ng c√≥ th√¥ng tin thi√™n tai g·∫ßn ƒë√¢y.</p>
                            </div>
                        }
                    }
                    else
                    {
                        <p style="color: #666; font-size: 0.9rem; text-align: center;">Kh√¥ng c√≥ th√¥ng tin thi√™n tai g·∫ßn ƒë√¢y.</p>
                    }

                </div>
            </div>
 *@        </div>

       
        
        <div id="filterSection"
             style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center;
                   background: rgba(255, 255, 255, 0.9); padding: 20px 30px;
                   border-radius: 15px; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);    justify-content: center;">

            <select id="disasterTypeFilter"
                    style="padding: 12px; border: 1px solid #ddd; border-radius: 8px;
                       outline: none; transition: 0.3s; ">
                <option value="">T·∫•t c·∫£</option>
                @{
                    var uniqueDisasters = Model.Disasters
                    .Select(d => d.DisasterDetails.NameDisaster)
                    .Distinct()
                    .ToList();
                }
                @foreach (var disasterName in uniqueDisasters)
                {
                    <option value="@disasterName">@disasterName</option>
                }
            </select>

            <input type="text" id="affectedAreaSearch"
                   placeholder="T√¨m ki·∫øm Khu v·ª±c b·ªã ·∫£nh h∆∞·ªüng"
                   style="padding: 12px; border: 1px solid #ddd; border-radius: 8px;
                       outline: none; transition: 0.3s;" />

            <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="highestIdFilter"
                       style="accent-color: #2b6cb0; transform: scale(1.5);" />
                Thi√™n tai m·ªõi nh·∫•t
            </label>
        </div>
    </div>
</div>

<section class="ftco-section" style="background-color: #181818; padding: 30px 0;">
    <div class="container-fluid" style="display:flex;justify-content:center">
        <div class="row" style="max-width:1360px">
            <!-- Panel C·∫£nh B√°o -->
            <div class="col-lg-4" style="background-color: #;  border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); overflow-y: auto;max-width:410px;padding:inherit">
                <div class="">
                    <div class="">
                        <div class="" style="background-color: #FFF0F5; padding: 11px; border-radius: 10px;text-align:center">
                            <h2 style="color: #FF0000; font-size: 30px; font-weight: bold; animation: pulse 1s infinite;">
                                ‚ö†Ô∏èC·∫¢NH B√ÅO THI√äN TAI‚ö†Ô∏è
                            </h2>
                        </div>
                    </div>
                </div>
                <div >
                    @if (Model.Disasters != null && Model.Disasters.Count > 0)
                    {
                        var dateNow = DateTime.Now;
                        var recentDisasters = Model.Disasters
                        .OrderByDescending(d => d.TimeUpdate) // S·∫Øp x·∫øp gi·∫£m d·∫ßn theo th·ªùi gian c·∫≠p nh·∫≠t
                        .Take(4) // L·∫•y t·ªëi ƒëa 5 ph·∫ßn t·ª≠
                        .ToList();

                        var hasRecentDisaster = recentDisasters.Any();
                        @if (hasRecentDisaster)
                        {
                            foreach (var disaster in recentDisasters)
                            {
                                var levelClass = disaster.Level <= 3 ? "low-level" :
                                (disaster.Level > 3 && disaster.Level <= 7) ? "moderate-level" : "high-level";

                                <div class=" @levelClass" style=" border-radius: 5px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); font-size: 0.9rem;border-top: solid;padding-left:10px;
background-color: @(disaster.Level <= 3 ? "#d4edda" : (disaster.Level <= 7 ? "#fff3cd" : "#f8d7da"));
border-left: 5px solid @(disaster.Level <= 3 ? "#28a745" : (disaster.Level <= 7 ? "#ffc107" : "#dc3545"));">

                                    <strong>Lo·∫°i h√¨nh:</strong> @disaster.DisasterDetails?.NameDisaster <br>
                                    <strong>Khu v·ª±c:</strong> @disaster.AffectedArea <br>
                                    <strong>Th·ªùi gian:</strong> @disaster.TimeUpdate.ToString("g") <br>
                                    <strong>C·∫•p ƒë·ªô:</strong> @disaster.Level
                                    <form method="post" asp-page-handler="AddDisaster">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="disasterName" value="@disaster.DisasterDetails?.NameDisaster" />
                                        <input type="hidden" name="location" value="@disaster.AffectedArea" />
                                        <input type="hidden" name="description" value="@disaster.Description" />
                                        <input type="hidden" name="severityLevel" value="@disaster.Level" />
                                        <input type="hidden" name="idjson" value="@disaster.Id" />
                                        <button type="submit" style=" background: none; border: none;color:blue;text-decoration: underline;cursor: pointer;padding: 0; margin-right: 10px;">Chi ti·∫øt</button>
                                    </form>

                                </div>
                            }
                        }
                        else
                        {
                            <div style="display: flex; justify-content: center; align-items: center; height: 200px;">
                                <p style="color: #666; font-size: 0.9rem; text-align: center;">Kh√¥ng c√≥ th√¥ng tin thi√™n tai g·∫ßn ƒë√¢y.</p>
                            </div>
                        }
                    }
                    else
                    {
                        <p style="color: #666; font-size: 0.9rem; text-align: center;">Kh√¥ng c√≥ th√¥ng tin thi√™n tai g·∫ßn ƒë√¢y.</p>
                    }
                </div>
<div style="padding-top:10px">
                    <a asp-page="/User/ListDisaster" style="color: white; font-weight: bold; text-decoration: underline; font-size: 12px;"> Xem T·∫•t C·∫£</a>

</div>
            </div>

            <!-- Danh s√°ch kh·∫©n c·∫•p -->
            <div class="col-lg-8" style="max-width:950px">
                <div class="">
                    <div class="">
                        <div class="" style="background-color: #FFF0F5; padding: 16px; border-radius: 10px;text-align:center">
                            <h2 style="color: #FF0000; font-size: 34px; font-weight: bold; animation: pulse 1s infinite;">
                                ‚ö†Ô∏è KH·∫®N C·∫§P! DANH S√ÅCH NG∆Ø·ªúI C·∫¶N H·ªñ TR·ª¢ ‚ö†Ô∏è
                            </h2>
                            <p style="color: #FF0000; font-size: 18px; font-weight: bold;">
                                N·∫øu b·∫°n ·ªü g·∫ßn, vui l√≤ng gi√∫p ƒë·ª° ngay l·∫≠p t·ª©c! M·ªçi s·ª± h·ªó tr·ª£ ƒë·ªÅu v√¥ c√πng qu√Ω gi√°!
                            </p>
                        </div>
                    </div>
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: start; width: 100%;">
                    @if (Model.Reports != null && Model.Reports.Any())
                    {
                        int count = 0;
                        @foreach (var report in Model.Reports)
                        {
                            if (count >= 6)
                            {
                                break;
                            }
                            var currentTime = DateTime.Now;
                            var reportTime = report.CreateTime ?? DateTime.MinValue;
                            var daysDifference = (currentTime - reportTime).TotalDays;

                            string backgroundColor;
                            if (daysDifference < 1)
                            {
                                backgroundColor = "#ff0000";
                            }
                            else if (daysDifference < 2)
                            {
                                backgroundColor = "#F7FF00";
                            }
                            else
                            {
                                backgroundColor = "#13EF4D";
                            }
                            <div class="emergency-card" style="flex: 0 0 calc(33.33% - 10px); border: 3px solid @backgroundColor; border-radius: 8px; animation: alertBlink 1s infinite; background-color: #f5f5f5; padding: 10px; margin-bottom: 10px;">
                                <div class="block-20" style="background-color: #ffcccc; height: 30px; text-align: center; display: flex; justify-content: center; align-items: center; position: relative; font-size: 16px; color: #666; padding: 5px;">
                                    <span>üö®</span>
                                    <div class="badge badge-danger" style="position: absolute; top: 5px; right: 5px; font-size: 12px; color: white; background-color: red; padding: 3px 6px; border-radius: 5px; animation: pulse 1s infinite;">KH·∫®N C·∫§P</div>
                                </div>
                                <div class="text" style="font-size: 12px; color: #333; font-weight: bold; margin-top: 10px;">
                                    <div style="margin-bottom: 5px;">
                                        <span style="color: #ff0000; font-weight: bold;">üïí Th·ªùi gian: @report.CreateTime?.ToString("'Ng√†y 'dd' Th√°ng' MM, yyyy 'l√∫c' HH:mm")</span>
                                    </div>
                                    <p style="color: #555; margin-bottom: 10px; font-size: 14px; word-wrap: break-word; white-space: normal; overflow-wrap: break-word;">@report.Content</p>
                                    <a asp-page="/User/DetailSos" asp-route-s_id="@report.SosId" style="color: blue; font-weight: bold; text-decoration: underline; font-size: 12px;">Chi Ti·∫øt</a>
                                </div>
                            </div>
                            count++;
                        }
                    }
                    else
                    {
                        <div style="width: 100%; text-align: center; font-size: 16px; font-weight: bold; color: #888; padding: 20px; background-color: #fff; border-radius: 8px;">
                            Kh√¥ng C√≥ L·ªùi K√™u C·ª©u Trong M·∫•y Ng√†y G·∫ßn ƒê√¢y
                        </div>
                    }
                </div>                    <a asp-page="/User/ListSos" style="color: white; font-weight: bold; text-decoration: underline; font-size: 12px;"> Xem T·∫•t C·∫£</a>

            </div>
        </div>
    </div>
</section>




  <script>
    document.addEventListener("DOMContentLoaded", function () {
        const sosButton = document.getElementById("sosButton");
        const reportModal = document.getElementById("reportModal");

        sosButton.addEventListener("click", function () {
            if (confirm("ƒê√¢y l√† t√≠nh nƒÉng kh·∫©n c·∫•p!!!Ch·ªâ n√™n s·ª≠ d·ª•ng n√≥ khi th·ª±c s·ª± c·∫ßn thi·∫øt ƒë·ªÉ tr√°nh √°nh h∆∞·ªüng t·ªõi m·ªçi ng∆∞·ªùi !!!")) {
                // If confirmed, show the modal
                reportModal.style.display = "block"; // Show the modal
            }
        });

        // Function to close the modal
        window.onclick = function (event) {
            if (event.target == reportModal) {
                reportModal.style.display = "none"; // Hide the modal
            }
        };
    });
</script>

 <script>
    document.getElementById('getLocation').addEventListener('click', function () {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                document.getElementById('longitude').value = position.coords.longitude;
                document.getElementById('latitude').value = position.coords.latitude;
                alert("Location retrieved: Longitude " + position.coords.longitude + ", Latitude " + position.coords.latitude);
            }, function () {
                alert("Unable to retrieve your location.");
            });
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    });
</script>

  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
  <script src="https://api.windy.com/assets/map-forecast/libBoot.js"></script>
  <script>
        const options = {
            key: '44phXZRSg6vYJF3qnHWy1uVVY4SIuITf',  
            lat: 21.0285,        
            lon: 105.8542,       
            zoom: 5,           
        };

        windyInit(options, windyAPI => {
            const map = windyAPI.map; // L·∫•y ƒë·ªëi t∆∞·ª£ng b·∫£n ƒë·ªì

            // T·∫°o m·ªôt layer group ƒë·ªÉ qu·∫£n l√Ω c√°c marker
            const disasterLayer = L.layerGroup().addTo(map);
        const markers = {};
            // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu t·ª´ Model
            var dis = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Disasters));

            console.log(dis); // Log ƒë·ªÉ ki·ªÉm tra m·∫£ng disasters

            // H√†m ƒë·ªÉ hi·ªÉn th·ªã markers theo l·ª±a ch·ªçn
            function displayMarkers(filter = "", search = "", showHighestId = false) {
                disasterLayer.clearLayers(); // X√≥a t·∫•t c·∫£ marker hi·ªán t·∫°i
                if (dis && dis.length > 0) {

                     let maxId = Math.max(...dis.map(d => d.id)); 
                    console.log('Max ID:', maxId);

                    dis.forEach(disaster => {
                        if (disaster.lat && disaster.lon) {
                             const affectedArea = disaster.kv_anhhuong.toLowerCase();
                            const searchLower = search.toLowerCase();

                             const matchesFilter = (filter === "" || disaster.disaster.name_disaster === filter);
                            const matchesSearch = (search === "" || affectedArea.includes(searchLower));
                            const isHighestId = showHighestId ? disaster.id === maxId : true; 

                            console.log(`Disaster ID: ${disaster.id}, Matches: ${matchesFilter}, ${matchesSearch}, Highest ID: ${isHighestId}`);

                            // Ki·ªÉm tra xem lo·∫°i thi√™n tai c√≥ kh·ªõp v·ªõi filter kh√¥ng
                            if (matchesFilter && matchesSearch && isHighestId) {
                                // T·∫°o marker v√† th√™m v√†o layer group
                                const marker = L.marker([disaster.lat, disaster.lon]);
                                marker.addTo(disasterLayer);

                                // T·∫°o n·ªôi dung popup v·ªõi c√°c thu·ªôc t√≠nh c·∫ßn thi·∫øt
                            const popupContent = `
        <strong>Lo·∫°i h√¨nh thi√™n tai:</strong> ${disaster.name_vn}<br>
        <strong>Th·ªùi gian:</strong> ${new Date(disaster.time_update).toLocaleString()}<br>
        <strong>V·ªã tr√≠:</strong> ${disaster.lon}, ${disaster.lat}<br>
        <strong>Kgu v·ª±c ·∫£nh h∆∞·ªüng:</strong> ${disaster.kv_anhhuong}<br>
        <strong>Lo·∫°i thi√™n tai:</strong> ${disaster.disaster.name_disaster}<br>
        <strong>C·∫•p ƒë·ªô thi√™n tai:</strong> ${disaster.level}<br>
                   <form method="post" action="?handler=AddDisaster">
    @Html.AntiForgeryToken()
        <input type="hidden" name="disasterName" value="${disaster.name_vn}" />
        <input type="hidden" name="location" value="${disaster.kv_anhhuong}" />
        <input type="hidden" name="description" value="${disaster.description}" />
        <input type="hidden" name="severityLevel" value="${disaster.level}" />
            <input type="hidden" name="idjson" value="${disaster.id}" />
        <button type="submit" class="btn btn-primary">Chi ti·∫øt</button>
    </form>

           

    `;

                                marker.bindPopup(popupContent);
                            markers[disaster.id] = marker;

                            }
                        } else {
                            console.warn('Invalid latitude or longitude for disaster:', disaster);
                        }
                    });
                } else {
                    console.warn('No disasters found or disasters data is empty.');
                }
            }

            // Hi·ªÉn th·ªã t·∫•t c·∫£ markers ban ƒë·∫ßu
            displayMarkers();
        // Add click event to each warning box to scroll to marker on the map
        document.querySelectorAll('.warning-box').forEach(box => {
            box.addEventListener('click', function () {
                const disasterId = parseInt(this.getAttribute('data-id'));

                // Check if marker exists and navigate the map to it
                if (markers[disasterId]) {
                    map.setView(markers[disasterId].getLatLng(), 8); // Adjust zoom level if necessary
                    markers[disasterId].openPopup(); // Open the marker's popup
                }
            });
        });
            // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi ch·ªçn lo·∫°i thi√™n tai
           document.getElementById('disasterTypeFilter').addEventListener('change', (event) => {
                const selectedDisaster = event.target.value; 
                const searchInput = document.getElementById('affectedAreaSearch').value; 
                const showHighestId = document.getElementById('highestIdFilter').checked;
                displayMarkers(selectedDisaster, searchInput, showHighestId); 
            });

            document.getElementById('affectedAreaSearch').addEventListener('input', (event) => {
                const searchValue = event.target.value; 
                const selectedDisaster = document.getElementById('disasterTypeFilter').value; 
                const showHighestId = document.getElementById('highestIdFilter').checked; 
                displayMarkers(selectedDisaster, searchValue, showHighestId); 
            });

            document.getElementById('highestIdFilter').addEventListener('change', (event) => {
                const showHighestId = event.target.checked; 
                const selectedDisaster = document.getElementById('disasterTypeFilter').value; 
                const searchInput = document.getElementById('affectedAreaSearch').value; 
                displayMarkers(selectedDisaster, searchInput, showHighestId); 
            });
        });


    </script>

  <script>
    // Update address field with selected values
    function updateAddress() {
        const province = document.getElementById('province').value;
        const district = document.getElementById('district').value;
        const commune = document.getElementById('commune').value;
        const village = document.getElementById('village').value;

        let address = '';

        if (province) {
            address += document.getElementById('province').selectedOptions[0].text + ', ';
        }

        if (district) {
            address += document.getElementById('district').selectedOptions[0].text + ', ';
        }

        if (commune) {
            address += document.getElementById('commune').selectedOptions[0].text + ', ';
        }

        if (village) {
            address += village + ', ';
        }

        // Remove last comma and space if present
        address = address.trim().replace(/,$/, '');

        // Set the address field value
        document.getElementById('address').value = address;
    }

    // Fetch and populate the province, district, and commune dropdowns
    fetch('https://provinces.open-api.vn/api/?depth=2')
        .then(response => response.json())
        .then(data => {
            const provinceSelect = document.getElementById('province');
            data.forEach(province => {
                const option = document.createElement('option');
                option.value = province.code;
                option.textContent = province.name;
                provinceSelect.appendChild(option);
            });

            provinceSelect.addEventListener('change', function () {
                const selectedProvince = provinceSelect.value;
                if (selectedProvince) {
                    loadDistricts(selectedProvince);
                } else {
                    clearDistricts();
                }
            });
        });

    function loadDistricts(provinceCode) {
        fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`)
            .then(response => response.json())
            .then(data => {
                const districtSelect = document.getElementById('district');
                districtSelect.innerHTML = '<option value="">Select District</option>';
                data.districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district.code;
                    option.textContent = district.name;
                    districtSelect.appendChild(option);
                });
                districtSelect.disabled = false;
                document.getElementById('commune').disabled = true;
                document.getElementById('village').disabled = true;
                document.getElementById('village').value = '';
            });
    }

    function clearDistricts() {
        document.getElementById('district').disabled = true;
        document.getElementById('district').innerHTML = '<option value="">Select District</option>';
        document.getElementById('commune').disabled = true;
        document.getElementById('commune').innerHTML = '<option value="">Select Commune</option>';
        document.getElementById('village').disabled = true;
        document.getElementById('village').value = '';
    }

    document.getElementById('district').addEventListener('change', function () {
        const selectedDistrict = this.value;
        if (selectedDistrict) {
            loadCommunes(selectedDistrict);
        } else {
            document.getElementById('commune').disabled = true;
            document.getElementById('commune').innerHTML = '<option value="">Select Commune</option>';
            document.getElementById('village').disabled = true;
            document.getElementById('village').value = '';
        }
    });

    function loadCommunes(districtCode) {
        fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`)
            .then(response => response.json())
            .then(data => {
                const communeSelect = document.getElementById('commune');
                communeSelect.innerHTML = '<option value="">Select Commune</option>';
                data.wards.forEach(commune => {
                    const option = document.createElement('option');
                    option.value = commune.code;
                    option.textContent = commune.name;
                    communeSelect.appendChild(option);
                });

                communeSelect.disabled = false;
                document.getElementById('village').disabled = false;
            });
    }

    document.getElementById('commune').addEventListener('change', function () {
        const selectedCommune = this.value;
        if (selectedCommune) {
            document.getElementById('village').disabled = false;
        } else {
            document.getElementById('village').disabled = true;
            document.getElementById('village').value = '';
        }
    });



    </script>